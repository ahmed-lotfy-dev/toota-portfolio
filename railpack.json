{
  "$schema": "https://schema.railpack.com",
  "buildAptPackages": ["postgresql-client", "zip", "unzip", "bison", "re2c", "pkg-config", "autoconf", "build-essential", "libxml2-dev", "libsqlite3-dev", "libcurl4-openssl-dev", "libssl-dev", "zlib1g-dev", "libreadline-dev", "libonig-dev", "libzip-dev", "libpng-dev", "libjpeg-dev", "libfreetype6-dev", "libicu-dev"],
  "packages": {
    "php": "8.4",
    "node": "22"
  },
  "steps": {
    "install": {
      "commands": [
        "composer install --optimize-autoloader --no-dev --no-scripts --no-interaction",
        "npm ci --include=dev || npm install --include=dev"
      ]
    },
    "build": {
      "inputs": [{ "step": "install" }],
      "commands": [
        "npm run build",
        "mkdir -p .frankenphp/conf.d",
        "chmod -R 777 storage bootstrap/cache",
        "php artisan config:cache",
        "php artisan route:cache",
        "php artisan view:cache",
        "php artisan storage:link"
      ]
    }
  },
  "deploy": {
    "startCommand": "./fix-production-build.sh && frankenphp run --workers=3 public/index.php",
    "aptPackages": ["postgresql-client", "zip", "unzip"],
    "inputs": [
      {
        "step": "build",
        "include": ["."]
      }
    ]
  }
}
